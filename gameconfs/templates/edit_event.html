{% extends "layout.html" %}

{% macro form_control(field, placeholder="", class="span4", show_at_symbol=False) %}
    {% if field.errors %}
    <div class="control-group error">
    {% else %}
    <div class="control-group">
    {% endif %}
      {{ field.label(class="control-label") }}
      <div class="controls">
      {%  if show_at_symbol %}
      <div class="input-prepend"><span class="add-on">@</span>{{ field(class=class, placeholder=placeholder) }}</div>
      {% else %}
      {{ field(class=class, placeholder=placeholder) }}
      {% endif %}
      {% if field.errors %}
      <span class="help-inline">{% for error in field.errors %}{{ error }} {% endfor %}</span>
      {% else %}
      {% endif %}
      </div>
    </div>
{% endmacro %}

{% macro flash() %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash_msgs">
    {% for category, message in messages %}
      <li class="alert alert-{{ category }}">{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
{% endmacro %}

{% block title %}
{% if event_id %}
Edit event - Gameconfs
{% else %}
New event - Gameconfs
{% endif %}
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/datepicker.css') }}">
    <script src="{{ url_for('static', filename='js/modernizr-latest.js') }}"></script>
{%  endblock %}

{% block content %}
{% if event_id %}
<form class="form-horizontal" method="POST" action="{{ url_for('edit_event', id=event_id) }}">
  <legend>Edit event data</legend>
{% else %}
<form class="form-horizontal" method="POST" action="{{ url_for('new_event') }}">
  <legend>Enter data for a new event</legend>
{% endif %}
  {{ flash() }}
  <fieldset>
    {{ form.hidden_tag() }}
    {{ form_control(form.name, "Game Developers Conference 2013") }}
    {{ form_control(form.start_date, class="span2 datepicker") }}
    {{ form_control(form.end_date, class="span2 datepicker") }}
    {{ form_control(form.event_url, "http://www.gdconf.com") }}
    {{ form_control(form.twitter_account, "Official_GDC", class="span2", show_at_symbol=True) }}
    {{ form_control(form.twitter_hashtags, "#gdc #gdc13") }}
    {{ form_control(form.venue, "Moscone Conference Center") }}
    {{ form_control(form.address, "San Francisco, USA (leave empty for online events)") }}
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save</button>
        {% if event_id %}
        <a class="btn" href="{{ url_for('event', id=event_id) }}">Cancel</a>
        {% endif %}
    </div>
  </fieldset>
</form>
{% endblock %}

{% block end_of_body %}
<script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script>
<script src="{{ url_for('static', filename='js/event-editing.js') }}"></script>
{% endblock %}